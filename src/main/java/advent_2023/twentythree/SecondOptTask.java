package advent_2023.twentythree;

import java.util.HashSet;
import java.util.Objects;

public class SecondOptTask {

    record Point(int row, int col) {}

    record Direction(int row, int col) {

    }

    record PointAndDirection(Point point, Direction direction) {}

    enum Directions {
        UP(new Direction(-1, 0)),
        DOWN(new Direction(1, 0)),
        LEFT(new Direction(0, -1)),
        RIGHT(new Direction(0, 1));

        private final Direction direction;

        Directions(Direction direction) {
            this.direction = direction;
        }

        public Direction getDirection() {
            return direction;
        }
    }

    public static void main(String[] args) {
        var input = """
                #.###########################################################################################################################################
                #.#...#...#.........###.........###...#...###...#...#...#.....#...#...#...#...#...#...#...#...#...#...#...#.....###.....#...#...###.....#...#
                #.#.#.#.#.#.#######.###.#######.###.#.#.#.###.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.###.###.###.#.#.#.#.###.###.#.#.#
                #.#.#...#.#.......#.#...#.......#...#.#.#.#...#.#.#.#.#...#...#.#...#.#.#.#.#...#.#.#.#.#.#.#.#.#.#.#.#.#.#...#...#...#.#.#.#.#.###.#...#.#.#
                #.#.#####.#######.#.#.###.#######.###.#.#.#.###.#.#.#.#####.###.#####.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#.#.###.###.###.#.#.#.#.#.###.#.###.#.#
                #.#.#.....#...#...#.#...#...>.>.#...#.#.#.#...#.#.#.#.#.....#...#.....#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#.#.#...#...#...#.#.#.#.#.#...#...#.#.#
                #.#.#.#####.#.#.###.###.#####v#.###.#.#.#.###.#.#.#.#.#.#####.###.#####.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#.#.###.###.###.#.#.#.#.#.#####.#.#.#
                #.#.#...#...#.#...#...#.#.....#.....#.#.#.#...#.#.#.#.#.>.>.#...#.#...#.#.#.#.#...#.#...#.#.#.#.#...#...#.#...#.#...###...#.#.#.#.###...#.#.#
                #.#.###.#.###v###.###.#.#.###########.#.#.#.###.#.#.#.###v#.###.#.#.#.#.#.#.#.#.#.#.#####.#.#.#.#########.###.#.#.#########.#.#.#.###.###.#.#
                #...###.#.###.>.#...#...#...#.......#...#.#...#.#.#.#.#...#...#.#...#.#.#.#.#.#.#.#.....#.#.#.#.......#...#...#.#.......#...#.#.#...#.....#.#
                #######.#.###v#.###.#######.#.#####.#####.###.#.#.#.#.#.#####.#.#####.#.#.#.#.#.#.#####.#.#.#.#######.#.###.###.#######.#.###.#.###.#######.#
                #.......#.#...#...#.....###...#.....###...#...#.#.#.#.#.....#...#.....#.#.#.#.#.#.###...#.#.#...#.>.>.#.#...#...#.......#.....#.#...#...#...#
                #.#######.#.#####.#####.#######.#######.###.###.#.#.#.#####.#####.#####.#.#.#.#.#.###.###.#.###.#.#v###.#.###.###.#############.#.###.#.#.###
                #.#...#...#.....#.#.....#...###.....#...#...###.#.#...#.....#...#...#...#.#.#.#.#.>.>.###.#...#...#...#.#...#...#.....###...#...#.#...#...###
                #.#.#.#.#######.#.#.#####.#.#######.#.###.#####.#.#####.#####.#.###.#.###.#.#.#.###v#####.###.#######.#.###.###.#####.###.#.#.###.#.#########
                #.#.#...#.......#...#...#.#.........#...#.....#.#.#.....#.....#...#...###.#.#.#.#...#...#.#...#.......#...#...#...#...#...#...#...#.........#
                #.#.#####.###########.#.#.#############.#####.#.#.#.#####.#######.#######.#.#.#.#.###.#.#.#.###.#########.###.###.#.###.#######.###########.#
                #.#.#.....#...#...#...#.#.............#...#...#...#.......#...###.#.....#...#...#.....#.#.#.#...#...#####.....###.#...#...#.....#...#.......#
                #.#.#.#####.#.#.#.#.###.#############.###.#.###############.#.###.#.###.###############.#.#.#.###.#.#############.###.###.#.#####.#.#.#######
                #.#.#.......#...#...#...#.............###...#...#...........#.....#.#...#...#.........#.#...#...#.#...#...#...###.....###...#...#.#.#.#...###
                #.#.#################.###.###################.#.#.#################.#.###.#.#.#######.#.#######.#.###.#.#.#.#.###############.#.#.#.#.#.#.###
                #.#.#.......###...#...###...............#...#.#.#...................#...#.#.#.......#.#.......#...###...#...#.......#...#...#.#.#.#.#...#.###
                #.#.#.#####.###.#.#.###################.#.#.#.#.#######################.#.#.#######.#.#######.#####################.#.#.#.#.#.#.#.#.#####.###
                #...#.....#.....#...#...###...........#.#.#...#.#.......#...............#.#.........#.....#...#.....#.............#.#.#...#...#...#.....#...#
                #########.###########.#.###.#########.#.#.#####.#.#####.#.###############.###############.#.###.###.#.###########.#.#.#################.###.#
                #.........#.....#...#.#.#...#.......#...#...#...#.#.....#...............#.......#...#...#...###...#.#...........#.#.#...#.....#...#...#...#.#
                #.#########.###.#.#.#.#.#.###.#####.#######.#.###.#.###################.#######.#.#.#.#.#########.#.###########.#.#.###.#.###.#.#.#.#.###.#.#
                #...........###...#...#.#.#...#...#...#...#.#...#.#...#...###...###.....#.......#.#...#.#...#.....#.#...........#...###...###...#.#.#.###...#
                #######################.#.#.###.#.###.#.#.#.###.#.###.#.#.###.#.###.#####.#######.#####.#.#.#.#####.#.###########################.#.#.#######
                #...................#...#...#...#.#...#.#.#.#...#...#.#.#.#...#.#...#...#.......#.#.....#.#.#.....#.#.#.....#.......#.......#...#...#.......#
                #.#################.#.#######.###.#.###.#.#.#.#####.#.#.#.#.###.#.###.#.#######.#.#.#####.#.#####.#.#.#.###.#.#####.#.#####.#.#.###########.#
                #...#.............#.#.....###...#...###.#.#.#.#...#.#.#.#.#...#.#...#.#.###...#.#.#.#...#.#.#...#.#.#.#.#...#.#.....#...#...#.#.#...........#
                ###.#.###########.#.#####.#####.#######.#.#.#.#.#.#.#.#.#.###.#.###v#.#.###.#.#v#.#.#.#.#.#.#.#.#.#.#.#.#.###.#.#######.#.###.#.#.###########
                ###...#...........#.......#...#...###...#.#.#.#.#.#.#.#.#.#...#...>.>.#.#...#.>.>.#.#.#...#.#.#...#.#.#.#.....#.#...#...#...#.#.#...........#
                #######.###################.#.###.###.###.#.#.#.#.#.#.#.#.#.#######v###.#.#####v###.#.#####.#.#####.#.#.#######.#.#.#.#####.#.#.###########.#
                ###.....#...........#.....#.#.#...#...###.#.#.#.#.#.#.#.#...#...#...###.#.#.....###...#.....#...#...#...#.......#.#.#.#.....#.#.#...#...#...#
                ###.#####.#########.#.###.#.#.#.###.#####.#.#.#.#.#.#.#.#####.#.#.#####.#.#.###########.#######.#.#######v#######.#.#.#.#####.#.#.#.#v#.#.###
                #...#...#.#.........#...#...#.#.###...#...#.#...#.#.#.#.#.....#...#...#.#.#...#...#...#.....#...#.#...#.>.>.....#.#.#.#...#...#...#.>.#...###
                #.###.#.#.#.###########.#####.#.#####.#.###.#####.#.#.#.#.#########.#.#.#.###.#.#.#.#.#####.#.###.#.#.#.#v#####.#.#.#.###.#.#########v#######
                #.....#...#.#...#...###...#...#.#.....#...#.....#...#...#...........#.#.#.###.#.#...#.#...#.#.###.#.#.#.#.....#.#.#.#.###...#.....#...#...###
                ###########.#.#.#.#.#####.#.###v#.#######.#####.#####################.#.#.###.#.#####.#.#.#.#.###.#.#.#.#####.#.#.#.#.#######.###.#.###.#.###
                #.........#...#.#.#...#...#.#.>.>.#######.......#.....................#.#...#.#.#.....#.#.#...###.#.#...#.....#...#.#.#.......###.#.....#...#
                #.#######.#####v#.###.#.###.#.#v#################.#####################.###.#.#.#.#####.#.#######.#.#####.#########.#.#.#########.#########.#
                #.....#...#...#.>.###...###...#.......#...#...###.....#...............#.....#...#.......#.......#...#.....#...#...#...#.........#.#.........#
                #####.#.###.#.#v#####################.#.#.#.#.#######.#.#############.#########################.#####.#####.#.#.#.#############.#.#.#########
                #...#.#.....#.#.....#...###...#.......#.#.#.#...#.....#.#.....#.......#...#...#...###...#...#...#.....#.....#...#.....#.........#.#.........#
                #.#.#.#######.#####.#.#.###.#.#.#######.#.#.###.#.#####.#.###.#.#######.#.#.#.#.#.###.#.#.#.#.###.#####.#############.#.#########.#########.#
                #.#.#.......#.#...#...#...#.#.#.........#.#.#...#.......#...#...###...#.#...#.#.#.....#...#.#...#.....#.#.......#...#.#.#...#####...#...#...#
                #.#.#######.#.#.#.#######.#.#.###########.#.#.#############.#######.#.#.#####.#.###########.###.#####.#.#.#####.#.#.#.#.#.#.#######.#.#.#.###
                #.#.........#...#.#.......#.#.............#.#.###...#...###.........#.#...#...#...........#.....#####...#.....#...#...#...#...#...#...#.#...#
                #.###############.#.#######.###############.#.###.#.#.#.#############.###.#.#############.###################.###############.#.#.#####.###.#
                #.........#.....#.#.....#...#.....#...#####.#...#.#.#.#.#.......#...#...#.#.#...#...#...#.......#.....#.......#...#...#...#...#.#...###...#.#
                #########.#.###.#.#####.#.###.###.#.#.#####.###.#.#.#.#.#.#####.#.#.###.#.#.#.#.#.#.#.#.#######.#.###.#.#######.#.#.#.#.#.#.###.###.#####.#.#
                #...#####...#...#.#.....#...#.###...#.......#...#.#.#.#.#.....#...#.....#.#.#.#...#.#.#.....#...#...#.#.......#.#.#.#.#.#.#.....#...#...#...#
                #.#.#########.###.#.#######.#.###############.###.#.#.#.#####.###########.#.#.#####.#.#####.#.#####.#.#######.#.#.#.#.#.#.#######.###.#.#####
                #.#...........###...###...#...#####...#.......#...#.#.#.#.....#.....#...#.#.#...#...#.....#...#...#.#.###.....#.#.#.#.#.#.#.....#.....#.....#
                #.#####################.#.#########.#.#.#######.###.#.#.#.#####.###.#.#.#.#.###.#.#######v#####.#.#.#.###v#####.#.#.#.#.#.#.###.###########.#
                #...#.......#...###...#.#.....#.....#...###...#.#...#.#.#.....#...#.#.#.#.#.#...#.......>.>...#.#.#.#.#.>.>.#...#.#.#...#.#.###.......#.....#
                ###.#.#####.#.#.###.#.#.#####.#.###########.#.#.#.###.#.#####v###.#.#.#.#.#.#.###########v###.#.#.#.#.#.#v#.#.###.#.#####.#.#########.#.#####
                ###...###...#.#.###.#.#.#.....#.........#...#.#.#...#.#...#.>.>...#...#.#.#.#.#.........#...#...#.#.#.#.#.#...###...#.....#.......#...#.....#
                #########v###.#.###.#.#.#.#############.#.###.#.###.#.###.#.#v#########.#.#.#.#.#######.###.#####.#.#.#.#.###########.###########.#.#######.#
                #.......#.>.#.#...#.#.#.#...#...#.......#...#.#...#.#.###...#.#.......#.#.#.#.#.......#.#...#...#.#.#...#...#####.....#...#...#...#.......#.#
                #.#####.#v#.#.###.#.#.#.###.#.#.#.#########.#.###.#.#.#######.#.#####.#.#.#.#.#######.#.#.###.#.#.#.#######.#####.#####.#.#v#.#.#########.#.#
                #.....#.#.#...###...#.#.#...#.#.#...###...#.#.#...#.#.###.....#.#...#.#.#.#.#.#.......#...#...#...#.....###.....#.......#.>.#...###.....#.#.#
                #####.#.#.###########.#.#.###.#.###v###.#.#.#.#.###.#.###.#####.#.#.#.#.#.#.#.#.###########.###########.#######.###########v#######.###.#.#.#
                #.....#...#...###...#.#.#.#...#.#.>.>.#.#.#.#.#...#.#.#...#.....#.#...#...#...#...........#.#...#...#...#.......#...........#.......#...#.#.#
                #.#########.#.###.#.#.#.#.#.###.#.#v#.#.#.#.#.###.#.#.#.###.#####.#######################.#.#.#.#.#.#.###.#######.###########.#######.###.#.#
                #.........#.#...#.#.#...#.#.###...#.#...#.#.#...#.#...#.....#...#...#####...#####...#...#.#.#.#...#...###...#...#.....#.......#...#...###...#
                #########.#.###.#.#.#####.#.#######.#####.#.###.#.###########.#.###.#####.#.#####.#.#.#.#.#.#.#############.#.#.#####.#.#######.#.#.#########
                #.........#...#...#.....#.#.#...#...#...#.#...#...#...#...#...#...#.....#.#...#...#.#.#...#...###...#######...#.....#...#.......#...#...#...#
                #.###########.#########.#.#.#.#.#.###.#.#.###.#####.#.#.#.#.#####.#####.#.###.#.###.#.###########.#.###############.#####.###########.#.#.#.#
                #...#.....#...#.........#...#.#.#...#.#.#.....#...#.#.#.#.#.....#.#.....#...#...###...###...###...#...#.....#.......###...#.....#...#.#.#.#.#
                ###.#.###.#.###.#############.#.###.#.#.#######.#.#.#.#.#.#####.#.#.#######.#############.#.###.#####.#.###.#.#########.###.###.#.#.#.#.#.#.#
                #...#.###...#...#...#...#.....#.....#.#.......#.#...#...#...#...#.#...#...#.......#...#...#.....#.....#...#.#.........#.....#...#.#...#...#.#
                #.###.#######.###.#.#.#.#.###########.#######.#.###########.#.###.###.#.#.#######.#.#.#.#########.#######.#.#########.#######.###.#########.#
                #...#...#.....#...#...#.#.#...#.......#.......#.......#...#...###.....#.#.......#...#.#.#...#...#...#...#.#.#.......#.###...#.....#.........#
                ###.###.#.#####.#######.#.#.#.#.#######.#############.#.#.#############.#######.#####.#.#.#.#.#.###.#.#.#.#.#.#####.#.###.#.#######.#########
                #...#...#...#...#.......#...#...#.......#...###...###...#.....#.......#.......#.......#...#...#...#.#.#.#.#.#.....#...#...#.......#.........#
                #.###.#####.#.###.###############.#######.#.###.#.###########.#.#####.#######.###################.#.#.#.#.#.#####v#####.#########.#########.#
                #.#...#.....#.###.......#...#...#.....#...#.#...#...#.....#...#.#.....#.......###.....###...#...#.#.#.#.#.#.#...>.>.###...#.....#.....#...#.#
                #.#.###.#####.#########.#.#.#.#.#####.#.###.#.#####.#.###.#.###.#.#####.#########.###.###.#.#.#.#.#.#.#.#.#.#.###v#.#####.#.###.#####.#.#.#.#
                #...###.......#####...#.#.#.#.#.#.....#...#.#.#.....#...#.#...#.#...#...#...#...#...#...#.#...#...#.#.#.#.#...#...#...###...###...###.#.#...#
                ###################.#.#.#.#.#.#.#.#######.#.#.#.#######.#.###v#.###.#.###.#.#.#.###.###.#.#########.#.#.#.#####.#####.###########v###.#.#####
                #...#...#...#...#...#...#.#.#.#.#.....#...#...#.#...#...#...>.>.#...#.....#...#.#...#...#.........#...#.#.#.....#...#...#.....#.>.###...#...#
                #.#.#.#.#.#.#.#.#.#######.#.#.#.#####.#.#######.#.#.#.#######v###.#############.#.###.###########.#####.#.#.#####.#.###.#.###.#.#v#######.#.#
                #.#...#...#...#.#...#...#.#.#.#.###...#.....#...#.#.#.###.....#...#...#.........#.#...#...#...###.....#.#.#...###.#.###.#.###...#.###.....#.#
                #.#############.###.#.#.#.#.#.#.###v#######.#.###.#.#.###.#####.###.#.#.#########.#.###.#.#.#.#######.#.#.###.###.#.###.#.#######.###.#####.#
                #.............#...#.#.#.#.#.#.#.#.>.>...#...#...#.#.#...#.....#.###.#.#.....#...#.#...#.#.#.#.#...#...#...###...#.#.#...#.......#...#...#...#
                #############.###.#v#.#.#.#.#.#.#.#v###.#.#####.#.#.###.#####.#.###.#.#####v#.#.#.###.#.#.#.#.#.#.#.###########.#.#.#.#########.###.###.#.###
                #.......#...#...#.#.>.#.#.#.#.#...#...#...#...#...#.#...#...#.#...#.#.....>.>.#.#.#...#.#.#.#...#.#.....#.......#.#.#.....#...#.###.....#...#
                #.#####.#.#.###.#.#v###.#.#.#.#######.#####.#.#####.#.###.#.#.###.#.#######v###.#.#.###.#.#.#####.#####.#.#######.#.#####.#.#.#.###########.#
                #.....#.#.#.....#...###...#.#.....###...#...#.....#.#.#...#.#.#...#.....#...###...#...#.#.#.#.....#.....#.........#.....#...#...#...........#
                #####.#.#.#################.#####.#####.#.#######.#.#.#.###.#.#.#######.#.###########.#.#.#.#.#####.###################.#########.###########
                #.....#.#...........#...###.......#...#...#.......#...#...#.#.#.........#.#...###...#...#...#.....#.###.........#.....#.#.........#...#.....#
                #.#####.###########.#.#.###########.#.#####.#############.#.#.###########.#.#.###.#.#############.#.###.#######.#.###.#.#.#########.#.#.###.#
                #.#...#...........#...#.....#...#...#.......###...#...#...#...#...#...#...#.#...#.#.#.........#...#...#.......#.#...#...#.....#.....#...#...#
                #.#.#.###########.#########.#.#.#.#############.#.#.#.#.#######.#.#.#.#.###.###.#.#.#.#######.#.#####.#######.#.###.#########.#.#########.###
                #.#.#...........#...........#.#.#...#.......###.#...#.#...#...#.#...#.#.....###...#...#.......#...#...#.......#.....###...###...#...#.....###
                #.#.###########.#############.#.###.#.#####.###.#####.###.#.#.#.#####.#################.#########.#.###.###############.#.#######.#.#.#######
                #...#.........#...#...#...###.#...#...#...#...#.#.....###...#...#.....#...#.....#.......###...###...###...........#...#.#.#...#...#.#.#.....#
                #####v#######.###.#.#.#.#.###.###.#####.#.###.#.#.###############.#####.#.#.###.#.#########.#.###################.#.#.#.#.#.#.#.###.#.#.###.#
                #...#.>.....#.....#.#.#.#.#...#...###...#.....#.#.#...#...#...###.#...#.#.#...#.#.....###...#.#...#...#...#.......#.#.#.#.#.#.#.#...#...#...#
                #.#.#v#####.#######.#.#.#.#.###.#####.#########.#.#.#.#.#.#.#.###v#.#.#.#.###.#.#####v###.###.#.#.#.#.#.#.#.#######.#.#.#.#.#.#.#.#######v###
                #.#...###...#...###.#.#.#.#...#.#...#.......###.#.#.#.#.#.#.#.#.>.>.#.#.#...#.#.....>.>.#...#.#.#.#.#.#.#.#.....#...#.#.#.#.#.#.#.#.....>.###
                #.#######.###.#.###.#.#.#.###.#.#.#.#######v###.#.#.#.#.#.#.#.#.#v###.#.###.#.#######v#.###.#.#.#.#.#.#.#.#####.#.###.#.#.#.#.#.#.#.#####v###
                #.#.....#.#...#.#...#.#.#.#...#...#.#.....>.>.#.#.#.#...#...#...#.#...#...#...#...#...#...#.#.#.#.#.#.#.#.###...#...#.#.#.#.#...#.#.#.....###
                #.#.###.#.#.###.#.###.#.#.#.#######.#.#####v#.#.#.#.#############.#.#####.#####.#.#.#####.#.#.#.#.#.#.#.#.###v#####.#.#.#.#.#####.#.#.#######
                #.#.#...#...#...#...#...#.#.#.......#...#...#...#...###...#...#...#.....#.#.....#...###...#.#.#.#.#.#.#.#...>.>.#...#.#.#.#.....#...#.......#
                #.#.#.#######.#####.#####.#.#.#########.#.#############.#.#.#.#.#######.#.#.###########.###.#.#.#.#.#.#.#####v#.#.###.#.#.#####.###########.#
                #.#.#.......#.#...#...###...#...........#.........###...#...#...#...###.#.#...........#...#.#.#.#.#.#.#.#.....#.#...#.#.#.#.....###...#.....#
                #.#.#######.#.#.#.###.###########################.###.###########.#.###.#.###########.###.#.#.#.#.#.#.#.#.#####.###.#.#.#.#.#######.#.#.#####
                #.#.#.......#...#.#...#.........#...#...#.........#...#...#.....#.#.#...#.#...........###...#.#.#.#.#...#.....#.#...#...#...###...#.#.#.....#
                #.#.#.###########.#.###.#######.#.#.#.#.#.#########.###.#.#.###.#.#.#.###.#.#################.#.#.#.#########.#.#.#############.#.#.#.#####.#
                #...#...........#.#.###.......#.#.#...#.#.......###.#...#.#.###...#.#.....#.................#.#.#.#.#.........#.#.......#.......#...#.#...#.#
                ###############.#.#.#########.#.#.#####.#######.###.#.###.#.#######.#######################.#.#.#.#.#.#########.#######.#.###########.#.#.#.#
                ###.............#...#...#...#.#.#.....#.#...#...#...#.#...#.#.....#...#.....................#...#...#.........#.........#.......#...#...#.#.#
                ###.#################.#.#.#.#.#.#####.#.#.#.#.###.###.#.###.#.###.###.#.#####################################.#################.#.#.#####.#.#
                #...#...............#.#...#.#.#.....#.#.#.#...###.....#.....#...#.....#.............###...#...........#.......#...#...#...#...#...#...###...#
                #.###.#############.#.#####.#.#####.#.#.#.#####################.###################.###.#.#.#########.#.#######.#.#.#.#.#.#.#.#######.#######
                #...#.#...#.........#.#...#...#...#.#.#.#.........#.......#...#...#...#.....#.....#.....#.#.........#.#.....###.#...#...#.#.#.......#...#...#
                ###.#.#.#.#.#########.#.#.#####.#.#.#.#.#########.#.#####.#.#.###.#.#.#.###.#.###.#######.#########.#.#####.###.#########.#.#######.###.#.#.#
                ###...#.#.#.........#...#.....#.#.#...#...........#.....#.#.#.#...#.#.#.#...#...#.........#...#...#.#...###...#.........#...#.......#...#.#.#
                #######.#.#########.#########.#.#.#####################.#.#.#.#.###.#.#.#.#####v###########.#.#.#.#.###.#####.#########.#####.#######.###.#.#
                #.......#...........#.......#.#.#.....#.....###...#...#.#...#.#.###.#.#.#...#.>.>.....#...#.#.#.#.#...#.......#...#...#.#.....#...#...###.#.#
                #.###################.#####.#.#.#####.#.###.###.#.#.#.#.#####.#.###.#.#.###.#.#######.#.#.#.#.#.#.###.#########.#.#.#.#.#.#####.#.#v#####.#.#
                #.#.................#.....#.#...#.....#...#...#.#.#.#.#.....#...#...#.#...#.#.#.......#.#.#.#.#.#...#.......#...#...#.#.#.#...#.#.>.#...#.#.#
                #.#.###############.#####.#.#####v#######.###.#.#.#.#.#####.#####.###.###.#.#.#.#######.#.#.#.#.###.#######.#.#######.#.#.#.#.#.###v#.#.#.#.#
                #.#.#...............#...#.#.###.>.>.#...#...#.#.#.#.#.#...#...#...###...#.#.#.#...#...#.#.#.#.#...#.#...###.#.......#.#.#.#.#.#.#...#.#...#.#
                #.#.#.###############.#.#.#.###.###.#.#.###.#.#.#.#.#.#.#.###v#.#######.#.#.#.###.#.#.#.#.#.#.###.#.#.#.###v#######.#.#.#.#.#.#.#.###.#####.#
                #...#.......###...###.#.#.#.#...###.#.#...#.#.#.#.#.#.#.#.#.>.>.#...###...#...#...#.#.#.#.#.#.#...#.#.#.#.>.>.#.....#.#.#.#.#.#.#.....#.....#
                ###########.###.#.###.#.#.#.#.#####.#.###.#.#.#.#.#.#.#.#.#.#####.#.###########.###.#.#.#.#.#.#.###.#.#.#.###.#.#####.#.#.#.#.#.#######.#####
                #.....#.....#...#.#...#.#.#.#...###.#.#...#.#.#.#.#.#.#.#.#.....#.#.#...........#...#.#.#.#.#.#.#...#.#.#...#.#.#...#...#...#...###.....#...#
                #.###.#.#####.###.#.###.#.#.###.###.#.#.###.#.#.#.#.#.#.#.#####.#.#.#.###########.###.#.#.#.#.#.#.###.#.###.#.#.#.#.###############.#####.#.#
                #...#.#.....#...#.#...#...#.....#...#.#...#.#.#.#.#.#.#.#.#...#...#.#...#.....#...###.#.#.#.#.#.#...#.#.#...#.#...#.#...###...#...#.#.....#.#
                ###.#.#####.###.#.###.###########.###.###.#.#.#.#.#.#.#.#.#.#.#####.###.#.###.#.#####.#.#.#.#.#.###.#.#.#.###.#####.#.#.###.#.#.#.#.#.#####.#
                #...#.......#...#...#.........#...#...#...#.#.#.#...#.#.#.#.#.#...#...#.#.#...#.#.....#.#.#.#.#.#...#.#.#.###.....#.#.#.....#...#...#.#.....#
                #.###########.#####.#########.#.###.###.###.#.#.#####.#.#.#.#.#.#.###.#.#.#.###.#.#####.#.#.#.#.#.###.#.#.#######.#.#.###############.#.#####
                #...#...#...#.....#.#...#.....#...#.###...#.#.#.....#.#.#.#.#.#.#...#.#.#.#...#.#.#...#.#.#.#.#.#...#.#.#.......#.#.#...#...#...#...#.#.#...#
                ###.#.#.#.#.#####.#.#.#.#.#######.#.#####.#.#.#####.#.#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#.#.#
                ###...#...#.......#...#...#######...#####...#.......#...#...#...###...#...###...#...#...#...#...###...#.........#...###...#...#...#...#...#.#
                ###########################################################################################################################################.#""";

        try {
            var map = input.lines().map(s -> s.split("")).toArray(String[][]::new);

            for(var row : map) {
                for(var col : row) {
                    System.out.print(col);
                }
                System.out.println();
            }

            try {
                map = preprocessMap(map);
            } catch (Exception e) {
                System.out.println(e.getMessage());
                for(var row : map) {
                    for(var col : row) {
                        System.out.print(col);
                    }
                    System.out.println();
                }
                return;
            }

            System.out.println();
            System.out.println();

            for(var row : map) {
                for(var col : row) {
                    System.out.print(col);
                }
                System.out.println();
            }

            var visited = new HashSet<Point>();

            var start = new Point(0, 1);

            var pathLength = travel(map, start, Directions.DOWN.getDirection(), 0, visited);

            System.out.println(pathLength);

        } catch (StackOverflowError e) {
            System.out.println(e.getMessage());
        }
    }

    private static String[][] preprocessMap(String[][] map) {
        for (int i = 0; i < map.length; i++) {
            for (int j = 0; j < map[0].length; j++) {

                if(Objects.equals(map[i][j], "#")) {
                    continue;
                }

                int corridorLength = 0;

                while((i == 0 || Objects.equals(map[i - 1][j + corridorLength], "#"))
                        && (i == map.length - 1 || Objects.equals(map[i + 1][j + corridorLength], "#"))
                        && (!map[i][j + corridorLength].equals("#"))
                        && (j + corridorLength + 1 < map[0].length)) {
                    corridorLength++;
                }

                if(corridorLength > 0) {
                    map[i][j] = "" + corridorLength;
                    map[i][j + corridorLength - 1] = "" + corridorLength;
                    j += corridorLength;
                }
            }
        }

        for (int j = 0; j < map[0].length; j++) {
            for (int i = 0; i < map.length; i++) {
                if(Objects.equals(map[i][j], "#")) {
                    continue;
                }

                int corridorLength = 0;

                while((j == 0 || Objects.equals(map[i + corridorLength][j - 1], "#"))
                        && (j == map[0].length - 1 || Objects.equals(map[i + corridorLength][j + 1], "#"))
                        && (!map[i + corridorLength][j].equals("#"))
                        && (i + corridorLength + 1 < map.length)) {
                    corridorLength++;
                }

                if(corridorLength > 0) {
                    map[i][j] = "" + corridorLength;
                    map[i + corridorLength - 1][j] = "" + corridorLength;
                    i += corridorLength;
                }
            }
        }

        return map;
    }

    private static long travel(String[][] map, Point point, Direction direction, long currentLength, HashSet<Point> vistited) {
        if(point.col < 0 || point.col >= map[0].length || point.row < 0 || point.row >= map.length) {
            return 0;
        }

        if(vistited.contains(point)) {
            return 0;
        }

        if(Objects.equals(map[point.row][point.col], "#")) {
            return 0;
        }

        if(point.row == map.length - 1 && point.col == map[0].length - 2) {
            System.out.println("Found the end, length: " + currentLength);
            return currentLength;
        }

        vistited.add(point);

        if((point.row == 0 || Objects.equals(map[point.row - 1][point.col], "#"))
                && (point.row == map.length - 1 || Objects.equals(map[point.row + 1][point.col], "#"))
                && (!map[point.row][point.col].equals("#"))) {
//            System.out.println("Found a corridor, length: " + map[point.row][point.col]);
//            System.out.println("Point row: " + point.row + ", col: " + point.col);

            var corridorLength = Integer.parseInt(map[point.row][point.col]);
            currentLength += corridorLength;

            if(direction.equals(Directions.UP.getDirection())) {
                throw new RuntimeException("Cannot go up");
            } else if(direction.equals(Directions.DOWN.getDirection())) {
                throw new RuntimeException("Cannot go down");
            } else if(direction.equals(Directions.LEFT.getDirection())) {
                return travel(map, new Point(point.row, point.col - corridorLength), Directions.LEFT.getDirection(), currentLength, new HashSet<>(vistited));
            } else if(direction.equals(Directions.RIGHT.getDirection())) {
                return travel(map, new Point(point.row, point.col + corridorLength), Directions.RIGHT.getDirection(), currentLength, new HashSet<>(vistited));
            }
        }

        if((point.col == 0 || Objects.equals(map[point.row][point.col - 1], "#"))
                && (point.col == map[0].length - 1 || Objects.equals(map[point.row][point.col + 1], "#"))
                && (!map[point.row][point.col].equals("#"))) {
//            System.out.println("Found a corridor, length: " + map[point.row][point.col]);
//            System.out.println("Point row: " + point.row + ", col: " + point.col);

            var corridorLength = Integer.parseInt(map[point.row][point.col]);
            currentLength += corridorLength;

            if(direction.equals(Directions.UP.getDirection())) {
                return travel(map, new Point(point.row - corridorLength, point.col), Directions.UP.getDirection(), currentLength, new HashSet<>(vistited));
            } else if(direction.equals(Directions.DOWN.getDirection())) {
                return travel(map, new Point(point.row + corridorLength, point.col), Directions.DOWN.getDirection(), currentLength, new HashSet<>(vistited));
            } else if(direction.equals(Directions.LEFT.getDirection())) {
                throw new RuntimeException("Cannot go left");
            } else if(direction.equals(Directions.RIGHT.getDirection())) {
                throw new RuntimeException("Cannot go right");
            }
        }

        currentLength++;

        var up = travel(map, new Point(point.row + Directions.UP.getDirection().row, point.col + Directions.UP.getDirection().col), Directions.UP.getDirection(), currentLength, new HashSet<>(vistited));
        var down = travel(map, new Point(point.row + Directions.DOWN.getDirection().row, point.col + Directions.DOWN.getDirection().col), Directions.DOWN.getDirection(), currentLength, new HashSet<>(vistited));
        var left = travel(map, new Point(point.row + Directions.LEFT.getDirection().row, point.col + Directions.LEFT.getDirection().col), Directions.LEFT.getDirection(), currentLength, new HashSet<>(vistited));
        var right = travel(map, new Point(point.row + Directions.RIGHT.getDirection().row, point.col + Directions.RIGHT.getDirection().col), Directions.RIGHT.getDirection(), currentLength, new HashSet<>(vistited));

        return Math.max(Math.max(up, down), Math.max(left, right));
    }
}
