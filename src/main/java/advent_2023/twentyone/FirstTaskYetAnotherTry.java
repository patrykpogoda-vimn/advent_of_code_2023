package advent_2023.twentyone;

import java.util.ArrayList;
import java.util.PriorityQueue;

public class FirstTaskYetAnotherTry {

    public static void main(String[] args) {
        var input = """
                ...................................................................................................................................
                ..#......##................#......#.#............#.....#....#.................#.......#.....#.#.....##.....#.#........#.#..#....#..
                .......#....###...###.........##...#.#..#.....#......#...#................................................#.........##.#.#..#..###.
                ....#.....#..#.#.....#....#.#.##.#..........#...#.......................#...##......#...#.#.#....###.....#....#......#....#...#.#..
                ..##.#......##...##......#...#.#.#..##.#......#.........#............................#.........#...................#....#........#.
                .#..........#....#.....#.....#..#.....#........#...........................#..#.#........#....#.#.....#.#...#..................#...
                .#.#.#.#.#............#.....#.....#....#...........#.........................................#...#.......#....#....#.......#..#..#.
                .#......##.#.#..............#....#.....####....#..#.............................#............#..............###.#.....#............
                ..#........#.........#....#................##..................#..#........................#.#.#.......###..#...#...#..............
                .......#........#.......##.#..#.............................#.........................#........#........#.#.#..##..#..#.#......#...
                .....#.#.#.##....................#.#.#....##.#....#...............#..###.......#.............#......#....#...#..#...............#..
                .#..#...#.........#............#..#......#.#.....#...........#....#.....#..........#...........##......##.....#.#........#.........
                ........#.....#..#......#....#.#........##.#...........................#.......................##.....##..#........#.#......#.#....
                ..........#..#...............#..#..........#...#..........#.....#..#...#...........#..................#...................###..#.#.
                .#..#......#..#...#.#..#.....#.....###.........#...........#.#............#........#.....###.......##.....#.#.#...........#........
                .#.....#....##..##..#...........#.....#.......#.........#...#..............##..........#...#..#..#...#............#.#.#.......#....
                .#..#.#.#.......#....................#................#.#................#..............#..#..##..#.#..#..###....#.....#..#........
                ...#.....#.......##..#............##.....#..#..........#......##.......#..............#.#..#.......#.........#.....................
                ..#.#.....#.......#....#.........##................##....#...#.......................................#.......#.#..##......#...#....
                ...........#.#.#.....#...#.#..#....#..#..............#.#.#....#....##...................#....#......#........#....#..##...#...#....
                ....#........#....#.#..##...##...................#.....#........#....#...#.#.#.#.............#.....#.#.......##..#.#.......#....#..
                .##.#....#.......#.#......##.....#.#.#............#.......#........#...........................#.......##...#...##....#.........#..
                .......#....#................#..##.............###.....#.............#....#......##........#.##...................#................
                ....#.......##.................#...................##..#..............#.......##..##...........#..##...#.#.....#...###.....#.......
                .#.............................##................#......#...#...........#.#.#......#...........##.....##................#.#........
                .#.##.#........##.........#.....##.#...........#...........#.#....##.....##.......#...........#..#.......#.##......#.....#...#...#.
                ...#...##.......#.#...#.......#...#.................#......#..#...............#.#.#........................#...........#.....#.....
                .......#.#...#..##.........#.....#........#..##.#.#....#........#..##..........#...#..#..............#......##..#....#.......#.....
                ...##.......#..#......#...........................#..#.........#.............##........#.........#...#................#..###.......
                .........................##................#.#...##....#......#.#..#....#....#....#..#..........................#.#..#.......#.....
                ....#.....#...#.........#..#............##...#..#........#........##.#..#...........#..........................#...#.....#......#..
                .......................#..............#..#...#...............#..#.#..#..#...#...#.#..........................#.......#..#..........
                ....##.#.............#...#.................##....#......#....#.##........#...............##............##.#.................#...#..
                ...#...#..#...........#........................#....#.#.......#..........#.......##.......................##..#.#....#...........#.
                ..............#......##............#...##.#..........#....#....#.......#...................##..............#...#........#..#..#....
                .......#............##..#.#........#....#.##....#.....#.#.#.....#......#....#..........#...#...#..................#....##..........
                .............#....#...#..#..............#.......#........##...#...#..#....#...........##....#............#....#...#.#.#........#...
                .#.....###.#.....................#..........#.#.....#..#...#.#.#.....................#.............................................
                .#...#...........#.....#...........#....#....##.........#..#......#..#....#.....#....#.#...#..................##.........#..#....#.
                .#.......#......................##.........................#....#...#......##......#........#......#.........#.......##.#...#......
                ....##...........#...#.......#.......##........#................#.......#.#.##.............#..#.#................##.....#..#...##..
                ..........#.#.................#..#..#...##.###.......##.#..#........##......##..##...#...#..#..#####.#.........#..#...#.#..........
                ..#....#..#.#...............#...............#.#..####......#..........##.#...##...#.#................#................#.##..##..#..
                ..........#....##..........#..............#.......#.......#.#...#..##.....................#.#.#....#...#...........#...............
                ...#.......#.................#...........#..#........#...#..............#..............#....#...##....................#...#........
                ...####...#.............##.....#............#.##.....#...#..#.#......#.............#.........##....##...................#.#...#....
                ....#.....#.............#.....##...#..#...........#..#.....#......#.#.....#......#.....#....#......#...............................
                .....#...#..##.............#....##...#.......#...##......##.....#.......#...#........................#.#.......................#.#.
                .###.....#...#................#....#.....................###.#....#..#.#....................#....................................#.
                ...#..................#..#..#........##....#..#.#.##..#.#...#.........#..#.#...#...............#...........##..........##.#........
                ...........#..................#.............#...#.#.#......###..........#...#.......#.......#....#........#.#...........##.........
                .......#..#.......##..#............................##.....#.#..#.......##.....#...#.......#...........#....#...#...................
                ...#.............#.................#.#.###......##.........####.....#..##.............#.......##.....#....................#........
                .#................#.#..#..#..#..##.....#.......#..#.....#.......#....#.......#.............#.##......#.#.....#..............#..#...
                .....#.................#...#....#.#...#.#......#.#...........#............#...#..........................###...#.................#.
                ...........................#..#.#..#...#...............#...#...#....#...........##...........#...#..#.#........#..###........#.....
                ..................##....##......##.#........#..#...........#......#..............#........#...#..............#...#.#..........##...
                ...#...............#...###..#...........#.....#.......##.#...#..........##.....#........#.#.#..................##..#............#..
                ..#........#......#.....#.........#.......##......#..........#...........#..#.##....#...................#.##.......##..........##..
                ...............#...##....###.........#...#..............#.#.......#...#.....#.........##..#.......##..............#................
                ............#........#......##.#................##...#.....##...#.....##.......#..................#........#.##.#.....#.##.........
                ..........#....#....#...##..#.#..........#.............##..#......#.#......#.#..............#........#...#..#............##........
                ...........#.......##...#......#..#......#.#.......#.........#...........#.....#..##...#...##..............##........#.#..#........
                ............#....#.......#..........#..##..#...##...#.#.#.....#............#.#.......#.#..#........##......#....#.#.....#..........
                .......................#...........##.#..........#.....#.#.#..........#.#.............................#....##.....##......#..#.....
                .................................................................S.................................................................
                .....#.##.#..........#..#..#........#.#...#......#......#....#.#.....#.#..............................#.............#.....#........
                ......#.....#....#..#........#.....#.........#........#..#...#.......#.#.....##.....##....#..#.#..#.#..........#....#...#..........
                ...................##....#........#.#.........#.......#........................#.....#.#...#..###.......###..#...#.....##..........
                .........#.#...#.#.#.#......#............#....#.#........................#.......#.#.#........#..............#..#.#...#............
                ...............#..#.#...#..#......#....#....#.......##...............#.#.#..#......#...##.........................#................
                .#.....................#..#..#..............#....#...#...#....##....#.#...#.......##.#...........###...#.......#####...............
                ..#........#............#.#...#.......#...#...........#......#....#...........#..#..............#....#..#...##.......#..........##.
                .#.#.....................#..............#.#.........#.#...............#......#......#.#..##...#......#......#........##............
                ..............#....#.#....##.##.....#........#...............#..........................#...#....#.##.........#....................
                ..................##...............##..#....##..............#.....#...#........#.#...#...............###....#................#.###.
                .#...#............#.#.#..##....#......#........#.#........#.....#......#.......##.....#.#.#.....................#..................
                ...#.#.............#.............#.#.##...#.#.............................................#....##..#.#.....#..................#....
                ......#............#...#.......#.#..#......#.......#.....#.#.......#...##....##....##.............####...................#..#......
                .........#........#.....#..#...........#.#.......##.#..#....#..#.....#.#..#.#....#......#...................#.............#....#.#.
                ......#................#..................#............#.............#.....#.........#...##.....#.#.##..#..###.........##.......#..
                .............................#....#.....#.#............##....#..#......#..#.#....#.................#....#...#.........#............
                ....#.#.....................#........#.........##..............#...#..............................#....#.................#.......#.
                .#..#.................#..........#..#....#........##..#...............#......####.....#....#.....#..#....###........#.#.........#..
                ....##........#.........#...#..##.#.##....#......##........#......###..........#.#...#....#..#......................#........##....
                ........#.....#.#.........#......#.#........#....#..##....##................##.......#...#........#...........................#....
                .#...........#............#..........#.......#.##.......#.#........#...#..###...#..#......#.............#................##....##..
                ..................#..........##...##....##.#.....#.....####........##........#...#.........#...#.....#..#...........##......#..#.#.
                ...............#.....................#................#...#....#......................#.#.......#...............#.....#......#...#.
                ...#............#.............#.##...................#....#...#.....#...#...........#.#...#........#................##.....#.......
                ...........#........#..................#.#..#.#.....#...............#.....#.#........##.......#..#.#..........#.............#......
                ..#.....#....#.#.................#.#.........#.......##.....#.........#.....#...............#.#...##.......................#....#..
                ......###....#....#.#..#....................#....#....#..#........#...#.#...##........#..##........#............#.........#....#.#.
                ...#.#.....#....#......#.........#..##...#.##...#....#..##..#.#........#..##.#.................#...................................
                .........###.#...#...#...........................#.........#.#.##....#.#...#..........#..#.......#.........##.....#......#...#.#...
                .................#.....#..........#.#..#..###..................#........##....#.........#...................#....#.........#.....#.
                .#..#....#..#...#.....#............#.#..........#....#.#..#..##......................#..#..#......................#.............#..
                ..#..#.#...#..#.....#...............................#.........##......#.............#.##...............#..#.##.......##..#.......#.
                .....#...#.#....#...#..#..............#......#.#................#....#..#...........#.....#.#................#.##.........##.......
                ....#......##.........#.#...#.........#......#.##...##........#....#.................#......................###......#.....##......
                ...#.#.....#.....#.#.#.#...............#..#.....#.#...............#.#.........##.....##..#...................#.......#.#...........
                ..#.....#..#.....#...##....##..##.........#...#....#....#...#......##.##..#..#.........#............#..#.##...................#....
                ...#....###...#..........##......#........#..........#.............###.....#.....#..#.#...............#...##....#...##..#..#...#.#.
                ...#................#.........#................#..#..#..#.#...............#.....#...................#.................#...#........
                .#.......#.#.#.#.......#...................#...#......##.....#........##.....#...#........................#..#..#....#......#..#...
                ..##..#....#...#.......#........#...#....................###........##............#...............#....#.......#............#......
                .#............#.....#...##....#.......................#..#....#........#..........#..#...........#..#........................#.....
                ..........###....#..#.#..#..#.........#.......#...#......#....#...#.............#............#.....................#.#...#.......#.
                ...#..#..............................#.........#........##....##....##..##.....##......................#........#.....#...#...#.#..
                .#.#.................##.......#.#.#.....................#.....#........#......##.............#.......#..##....##........#.#.#......
                ...##.#.#..#...#........#......#.....#....................#........#.#.....#...#................#........#...#.##.....#..#.......#.
                .##.#.......#..#....#..#....#......#.....................#...........#......#.#..............#...#......#.#.......#......#.#.......
                ....#................###...#.......#...#..##........#...................#.......................#..##.......#................###...
                .........##.....#.....##..........#....#..##.............#.....##......##....#..................#..##.................#...#........
                .#..#....#....#.#........#..#................#............#.......#........#...................................##........#.......#.
                .........##...#........#.#............#.......#..........#.................#..........................#......##.....#....#.#....##.
                ...##......................#.....#....#.##...................#.............#..............#....#......#.............#........#.....
                ....#...........##.......#...#.....#.......#..#................#........##......................#..#....#..##.....#.#..............
                ......#..#...#......#.......#.....#.#..........#................#................#.....#.#.#....#...#..............................
                ....#....#..#...##..##.......#...................##..............................#........#................#....#..........#..#.#..
                ....#...##.....##...#......#.............#.......#..............................#..........#...............................#.#.....
                .##.#.....#..#.......#..##................#..#..##..#..........#..............#..#.#....#.#..#..##.#....#.##..#............#.....#.
                ....#..#.#............##.....##.............###.#............#.#.....#....................#.#........#....#.#..#..#...........#.#..
                .#.......#..................#...................#....#..........#...........#....#......#.........#.............##...............#.
                ..#...............##..#.#...###.....#...#....#....#...#........#..#....................##.#.......#...#.......#................#...
                ..#.##..........##......#...#.#.#.#.....##.....#.##..#..#.........#........#....................#.................#............##..
                ....#...##.......##....##...#.#..............#.....#......................#.#......#...................#..#.#...##.#..........#..#.
                .#.#....#..##..#..............###.......................###................#..#..#..##....#....#............##..#..................
                ......#..#......#.........#.#.#...#.......................##..............##...#.....##.#....#......#....#.........#.......#.....#.
                ....#.........#...............#...#............#.........#................##.#..........#.............#.......................#.##.
                ...................................................................................................................................""";

        var map = input.lines().map(String::toCharArray).toArray(char[][]::new);
        var distances = new int[map.length][map[0].length];

        for (int i = 0; i < map.length; i++) {
            distances[i] = new int[map[0].length];

            for (int j = 0; j < map[0].length; j++) {
                distances[i][j] = 1000;
            }
        }

        var start = findStart(map);

        calculateDistances(start, map, distances);

        for (int i = 0; i < map.length; i++) {
            for (int j = 0; j < map[0].length; j++) {
                if (distances[i][j] > 64) {
                    System.out.print(map[i][j]);
                } else {
                    System.out.print(distances[i][j]);
                }
            }
            System.out.println();
        }

        System.out.println();

        int result = 0;

        for (int i = 0; i < map.length; i++) {
            for (int j = 0; j < map[0].length; j++) {
                if (distances[i][j] <= 64 && distances[i][j] % 2 == 0 && distances[i][j] != 1000) {
                    result++;
                    System.out.print("O");
                } else {
                    System.out.print(map[i][j]);
                }
            }
            System.out.println();
        }

        System.out.println(result);
    }

    private static void calculateDistances(Point target, char[][] map, int[][] distances) {
        record Pair(Point point, Integer distance) implements Comparable<Pair> {

            @Override
            public int compareTo(Pair o) {
                return distance.compareTo(o.distance);
            }
        }


        var queue = new PriorityQueue<Pair>();
        queue.add(new Pair(target, 0));

        while (!queue.isEmpty()) {
            var current = queue.poll();
            var currentDistance = current.distance + 1;

            if(distances[current.point.row][current.point.col] != 1000) {
                continue;
            }

            distances[current.point.row][current.point.col] = current.distance;

            var reachablePoints = new ArrayList<Point>();

            if(currentDistance > 64) {
                continue;
            }

            if (current.point.row - 1 >= 0 && map[current.point.row - 1][current.point.col] != '#' && distances[current.point.row - 1][current.point.col] == 1000) {
                reachablePoints.add(new Point(current.point.row - 1, current.point.col));
            }
            if (current.point.row + 1 < map.length && map[current.point.row + 1][current.point.col] != '#' && distances[current.point.row + 1][current.point.col] == 1000) {
                reachablePoints.add(new Point(current.point.row + 1, current.point.col));
            }
            if (current.point.col - 1 >= 0 && map[current.point.row][current.point.col - 1] != '#' && distances[current.point.row][current.point.col - 1] == 1000) {
                reachablePoints.add(new Point(current.point.row, current.point.col - 1));
            }
            if (current.point.col + 1 < map[0].length && map[current.point.row][current.point.col + 1] != '#' && distances[current.point.row][current.point.col + 1] == 1000) {
                reachablePoints.add(new Point(current.point.row, current.point.col + 1));
            }

            for (Point reachablePoint : reachablePoints) {
                queue.add(new Pair(reachablePoint, currentDistance));
            }
        }
    }

    private static Point findStart(char[][] map) {
        for (int i = 0; i < map.length; i++) {
            var row = map[i];

            for (int j = 0; j < row.length; j++) {
                if (row[j] == 'S') {
                    return new Point(i, j);
                }
            }
        }
        throw new RuntimeException("Start not found");
    }

    record Point(int row, int col) {

    }
}
