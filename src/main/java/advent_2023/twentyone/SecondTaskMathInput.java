package advent_2023.twentyone;

import java.io.FileWriter;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;

public class SecondTaskMathInput {

    public static void main(String[] args) {
        var input = """
                ...................................................................................................................................
                ..#......##................#......#.#............#.....#....#.................#.......#.....#.#.....##.....#.#........#.#..#....#..
                .......#....###...###.........##...#.#..#.....#......#...#................................................#.........##.#.#..#..###.
                ....#.....#..#.#.....#....#.#.##.#..........#...#.......................#...##......#...#.#.#....###.....#....#......#....#...#.#..
                ..##.#......##...##......#...#.#.#..##.#......#.........#............................#.........#...................#....#........#.
                .#..........#....#.....#.....#..#.....#........#...........................#..#.#........#....#.#.....#.#...#..................#...
                .#.#.#.#.#............#.....#.....#....#...........#.........................................#...#.......#....#....#.......#..#..#.
                .#......##.#.#..............#....#.....####....#..#.............................#............#..............###.#.....#............
                ..#........#.........#....#................##..................#..#........................#.#.#.......###..#...#...#..............
                .......#........#.......##.#..#.............................#.........................#........#........#.#.#..##..#..#.#......#...
                .....#.#.#.##....................#.#.#....##.#....#...............#..###.......#.............#......#....#...#..#...............#..
                .#..#...#.........#............#..#......#.#.....#...........#....#.....#..........#...........##......##.....#.#........#.........
                ........#.....#..#......#....#.#........##.#...........................#.......................##.....##..#........#.#......#.#....
                ..........#..#...............#..#..........#...#..........#.....#..#...#...........#..................#...................###..#.#.
                .#..#......#..#...#.#..#.....#.....###.........#...........#.#............#........#.....###.......##.....#.#.#...........#........
                .#.....#....##..##..#...........#.....#.......#.........#...#..............##..........#...#..#..#...#............#.#.#.......#....
                .#..#.#.#.......#....................#................#.#................#..............#..#..##..#.#..#..###....#.....#..#........
                ...#.....#.......##..#............##.....#..#..........#......##.......#..............#.#..#.......#.........#.....................
                ..#.#.....#.......#....#.........##................##....#...#.......................................#.......#.#..##......#...#....
                ...........#.#.#.....#...#.#..#....#..#..............#.#.#....#....##...................#....#......#........#....#..##...#...#....
                ....#........#....#.#..##...##...................#.....#........#....#...#.#.#.#.............#.....#.#.......##..#.#.......#....#..
                .##.#....#.......#.#......##.....#.#.#............#.......#........#...........................#.......##...#...##....#.........#..
                .......#....#................#..##.............###.....#.............#....#......##........#.##...................#................
                ....#.......##.................#...................##..#..............#.......##..##...........#..##...#.#.....#...###.....#.......
                .#.............................##................#......#...#...........#.#.#......#...........##.....##................#.#........
                .#.##.#........##.........#.....##.#...........#...........#.#....##.....##.......#...........#..#.......#.##......#.....#...#...#.
                ...#...##.......#.#...#.......#...#.................#......#..#...............#.#.#........................#...........#.....#.....
                .......#.#...#..##.........#.....#........#..##.#.#....#........#..##..........#...#..#..............#......##..#....#.......#.....
                ...##.......#..#......#...........................#..#.........#.............##........#.........#...#................#..###.......
                .........................##................#.#...##....#......#.#..#....#....#....#..#..........................#.#..#.......#.....
                ....#.....#...#.........#..#............##...#..#........#........##.#..#...........#..........................#...#.....#......#..
                .......................#..............#..#...#...............#..#.#..#..#...#...#.#..........................#.......#..#..........
                ....##.#.............#...#.................##....#......#....#.##........#...............##............##.#.................#...#..
                ...#...#..#...........#........................#....#.#.......#..........#.......##.......................##..#.#....#...........#.
                ..............#......##............#...##.#..........#....#....#.......#...................##..............#...#........#..#..#....
                .......#............##..#.#........#....#.##....#.....#.#.#.....#......#....#..........#...#...#..................#....##..........
                .............#....#...#..#..............#.......#........##...#...#..#....#...........##....#............#....#...#.#.#........#...
                .#.....###.#.....................#..........#.#.....#..#...#.#.#.....................#.............................................
                .#...#...........#.....#...........#....#....##.........#..#......#..#....#.....#....#.#...#..................##.........#..#....#.
                .#.......#......................##.........................#....#...#......##......#........#......#.........#.......##.#...#......
                ....##...........#...#.......#.......##........#................#.......#.#.##.............#..#.#................##.....#..#...##..
                ..........#.#.................#..#..#...##.###.......##.#..#........##......##..##...#...#..#..#####.#.........#..#...#.#..........
                ..#....#..#.#...............#...............#.#..####......#..........##.#...##...#.#................#................#.##..##..#..
                ..........#....##..........#..............#.......#.......#.#...#..##.....................#.#.#....#...#...........#...............
                ...#.......#.................#...........#..#........#...#..............#..............#....#...##....................#...#........
                ...####...#.............##.....#............#.##.....#...#..#.#......#.............#.........##....##...................#.#...#....
                ....#.....#.............#.....##...#..#...........#..#.....#......#.#.....#......#.....#....#......#...............................
                .....#...#..##.............#....##...#.......#...##......##.....#.......#...#........................#.#.......................#.#.
                .###.....#...#................#....#.....................###.#....#..#.#....................#....................................#.
                ...#..................#..#..#........##....#..#.#.##..#.#...#.........#..#.#...#...............#...........##..........##.#........
                ...........#..................#.............#...#.#.#......###..........#...#.......#.......#....#........#.#...........##.........
                .......#..#.......##..#............................##.....#.#..#.......##.....#...#.......#...........#....#...#...................
                ...#.............#.................#.#.###......##.........####.....#..##.............#.......##.....#....................#........
                .#................#.#..#..#..#..##.....#.......#..#.....#.......#....#.......#.............#.##......#.#.....#..............#..#...
                .....#.................#...#....#.#...#.#......#.#...........#............#...#..........................###...#.................#.
                ...........................#..#.#..#...#...............#...#...#....#...........##...........#...#..#.#........#..###........#.....
                ..................##....##......##.#........#..#...........#......#..............#........#...#..............#...#.#..........##...
                ...#...............#...###..#...........#.....#.......##.#...#..........##.....#........#.#.#..................##..#............#..
                ..#........#......#.....#.........#.......##......#..........#...........#..#.##....#...................#.##.......##..........##..
                ...............#...##....###.........#...#..............#.#.......#...#.....#.........##..#.......##..............#................
                ............#........#......##.#................##...#.....##...#.....##.......#..................#........#.##.#.....#.##.........
                ..........#....#....#...##..#.#..........#.............##..#......#.#......#.#..............#........#...#..#............##........
                ...........#.......##...#......#..#......#.#.......#.........#...........#.....#..##...#...##..............##........#.#..#........
                ............#....#.......#..........#..##..#...##...#.#.#.....#............#.#.......#.#..#........##......#....#.#.....#..........
                .......................#...........##.#..........#.....#.#.#..........#.#.............................#....##.....##......#..#.....
                .................................................................S.................................................................
                .....#.##.#..........#..#..#........#.#...#......#......#....#.#.....#.#..............................#.............#.....#........
                ......#.....#....#..#........#.....#.........#........#..#...#.......#.#.....##.....##....#..#.#..#.#..........#....#...#..........
                ...................##....#........#.#.........#.......#........................#.....#.#...#..###.......###..#...#.....##..........
                .........#.#...#.#.#.#......#............#....#.#........................#.......#.#.#........#..............#..#.#...#............
                ...............#..#.#...#..#......#....#....#.......##...............#.#.#..#......#...##.........................#................
                .#.....................#..#..#..............#....#...#...#....##....#.#...#.......##.#...........###...#.......#####...............
                ..#........#............#.#...#.......#...#...........#......#....#...........#..#..............#....#..#...##.......#..........##.
                .#.#.....................#..............#.#.........#.#...............#......#......#.#..##...#......#......#........##............
                ..............#....#.#....##.##.....#........#...............#..........................#...#....#.##.........#....................
                ..................##...............##..#....##..............#.....#...#........#.#...#...............###....#................#.###.
                .#...#............#.#.#..##....#......#........#.#........#.....#......#.......##.....#.#.#.....................#..................
                ...#.#.............#.............#.#.##...#.#.............................................#....##..#.#.....#..................#....
                ......#............#...#.......#.#..#......#.......#.....#.#.......#...##....##....##.............####...................#..#......
                .........#........#.....#..#...........#.#.......##.#..#....#..#.....#.#..#.#....#......#...................#.............#....#.#.
                ......#................#..................#............#.............#.....#.........#...##.....#.#.##..#..###.........##.......#..
                .............................#....#.....#.#............##....#..#......#..#.#....#.................#....#...#.........#............
                ....#.#.....................#........#.........##..............#...#..............................#....#.................#.......#.
                .#..#.................#..........#..#....#........##..#...............#......####.....#....#.....#..#....###........#.#.........#..
                ....##........#.........#...#..##.#.##....#......##........#......###..........#.#...#....#..#......................#........##....
                ........#.....#.#.........#......#.#........#....#..##....##................##.......#...#........#...........................#....
                .#...........#............#..........#.......#.##.......#.#........#...#..###...#..#......#.............#................##....##..
                ..................#..........##...##....##.#.....#.....####........##........#...#.........#...#.....#..#...........##......#..#.#.
                ...............#.....................#................#...#....#......................#.#.......#...............#.....#......#...#.
                ...#............#.............#.##...................#....#...#.....#...#...........#.#...#........#................##.....#.......
                ...........#........#..................#.#..#.#.....#...............#.....#.#........##.......#..#.#..........#.............#......
                ..#.....#....#.#.................#.#.........#.......##.....#.........#.....#...............#.#...##.......................#....#..
                ......###....#....#.#..#....................#....#....#..#........#...#.#...##........#..##........#............#.........#....#.#.
                ...#.#.....#....#......#.........#..##...#.##...#....#..##..#.#........#..##.#.................#...................................
                .........###.#...#...#...........................#.........#.#.##....#.#...#..........#..#.......#.........##.....#......#...#.#...
                .................#.....#..........#.#..#..###..................#........##....#.........#...................#....#.........#.....#.
                .#..#....#..#...#.....#............#.#..........#....#.#..#..##......................#..#..#......................#.............#..
                ..#..#.#...#..#.....#...............................#.........##......#.............#.##...............#..#.##.......##..#.......#.
                .....#...#.#....#...#..#..............#......#.#................#....#..#...........#.....#.#................#.##.........##.......
                ....#......##.........#.#...#.........#......#.##...##........#....#.................#......................###......#.....##......
                ...#.#.....#.....#.#.#.#...............#..#.....#.#...............#.#.........##.....##..#...................#.......#.#...........
                ..#.....#..#.....#...##....##..##.........#...#....#....#...#......##.##..#..#.........#............#..#.##...................#....
                ...#....###...#..........##......#........#..........#.............###.....#.....#..#.#...............#...##....#...##..#..#...#.#.
                ...#................#.........#................#..#..#..#.#...............#.....#...................#.................#...#........
                .#.......#.#.#.#.......#...................#...#......##.....#........##.....#...#........................#..#..#....#......#..#...
                ..##..#....#...#.......#........#...#....................###........##............#...............#....#.......#............#......
                .#............#.....#...##....#.......................#..#....#........#..........#..#...........#..#........................#.....
                ..........###....#..#.#..#..#.........#.......#...#......#....#...#.............#............#.....................#.#...#.......#.
                ...#..#..............................#.........#........##....##....##..##.....##......................#........#.....#...#...#.#..
                .#.#.................##.......#.#.#.....................#.....#........#......##.............#.......#..##....##........#.#.#......
                ...##.#.#..#...#........#......#.....#....................#........#.#.....#...#................#........#...#.##.....#..#.......#.
                .##.#.......#..#....#..#....#......#.....................#...........#......#.#..............#...#......#.#.......#......#.#.......
                ....#................###...#.......#...#..##........#...................#.......................#..##.......#................###...
                .........##.....#.....##..........#....#..##.............#.....##......##....#..................#..##.................#...#........
                .#..#....#....#.#........#..#................#............#.......#........#...................................##........#.......#.
                .........##...#........#.#............#.......#..........#.................#..........................#......##.....#....#.#....##.
                ...##......................#.....#....#.##...................#.............#..............#....#......#.............#........#.....
                ....#...........##.......#...#.....#.......#..#................#........##......................#..#....#..##.....#.#..............
                ......#..#...#......#.......#.....#.#..........#................#................#.....#.#.#....#...#..............................
                ....#....#..#...##..##.......#...................##..............................#........#................#....#..........#..#.#..
                ....#...##.....##...#......#.............#.......#..............................#..........#...............................#.#.....
                .##.#.....#..#.......#..##................#..#..##..#..........#..............#..#.#....#.#..#..##.#....#.##..#............#.....#.
                ....#..#.#............##.....##.............###.#............#.#.....#....................#.#........#....#.#..#..#...........#.#..
                .#.......#..................#...................#....#..........#...........#....#......#.........#.............##...............#.
                ..#...............##..#.#...###.....#...#....#....#...#........#..#....................##.#.......#...#.......#................#...
                ..#.##..........##......#...#.#.#.#.....##.....#.##..#..#.........#........#....................#.................#............##..
                ....#...##.......##....##...#.#..............#.....#......................#.#......#...................#..#.#...##.#..........#..#.
                .#.#....#..##..#..............###.......................###................#..#..#..##....#....#............##..#..................
                ......#..#......#.........#.#.#...#.......................##..............##...#.....##.#....#......#....#.........#.......#.....#.
                ....#.........#...............#...#............#.........#................##.#..........#.............#.......................#.##.
                ...................................................................................................................................
                """;

        var map = input
                .lines()
                .map(String::toCharArray)
                .toArray(char[][]::new);
        
        var rows = map.length;
        var cols = map[0].length;

        System.out.println("Rows = " + rows);
        System.out.println("Cols = " + cols);

        var startPoint = findStartPoint(map);

        var pointsToCheck = new ArrayList<Point>();
        var visited = new HashSet<Point>();

        pointsToCheck.add(startPoint);
        visited.add(startPoint);

        int currentStep = 0;
        long reached = 0;

        PrintWriter writer = null;

        try {
            writer = new PrintWriter(new FileWriter("output.txt"));
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }

        for(int i = 0; i < 50000; i++) {
            currentStep++;

            if (writer != null) {
                writer.println(reached);
            }

            var nextPoints = new ArrayList<Point>();

            for (var point : pointsToCheck) {
                for (var newPoint : List.of(
                        new Point(point.row + 1, point.col),
                        new Point(point.row - 1, point.col),
                        new Point(point.row, point.col + 1),
                        new Point(point.row, point.col - 1))
                ) {
                    if (!visited.contains(newPoint)) {
                        var rowToCheck = ((newPoint.row % rows) + rows) % rows;
                        var colToCheck = ((newPoint.col % cols) + cols) % cols;

                        if (map[rowToCheck][colToCheck] != '#') {
                            nextPoints.add(newPoint);
                            visited.add(newPoint);
                        }
                    }
                }
            }

            if (currentStep % 2 == 1) {
                reached += nextPoints.size();
            }
            pointsToCheck = nextPoints;
        }
    }

    private static Point findStartPoint(char[][] map) {
        for (int i = 0; i < map.length; i++) {
            for (int j = 0; j < map[0].length; j++) {
                if (map[j][i] == 'S') {
                    return new Point(i, j);
                }
            }
        }
        throw new RuntimeException("No start point found");
    }

    record Point(int row, int col) {
    }
}
