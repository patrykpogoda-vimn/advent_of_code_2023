package advent_2023.twentyone;

public class FirstTaskAnotherTry {

    record Point(int row, int col) {

    }

    public static void main(String[] args) {
        var input = """
                ...................................................................................................................................
                ..#......##................#......#.#............#.....#....#.................#.......#.....#.#.....##.....#.#........#.#..#....#..
                .......#....###...###.........##...#.#..#.....#......#...#................................................#.........##.#.#..#..###.
                ....#.....#..#.#.....#....#.#.##.#..........#...#.......................#...##......#...#.#.#....###.....#....#......#....#...#.#..
                ..##.#......##...##......#...#.#.#..##.#......#.........#............................#.........#...................#....#........#.
                .#..........#....#.....#.....#..#.....#........#...........................#..#.#........#....#.#.....#.#...#..................#...
                .#.#.#.#.#............#.....#.....#....#...........#.........................................#...#.......#....#....#.......#..#..#.
                .#......##.#.#..............#....#.....####....#..#.............................#............#..............###.#.....#............
                ..#........#.........#....#................##..................#..#........................#.#.#.......###..#...#...#..............
                .......#........#.......##.#..#.............................#.........................#........#........#.#.#..##..#..#.#......#...
                .....#.#.#.##....................#.#.#....##.#....#...............#..###.......#.............#......#....#...#..#...............#..
                .#..#...#.........#............#..#......#.#.....#...........#....#.....#..........#...........##......##.....#.#........#.........
                ........#.....#..#......#....#.#........##.#...........................#.......................##.....##..#........#.#......#.#....
                ..........#..#...............#..#..........#...#..........#.....#..#...#...........#..................#...................###..#.#.
                .#..#......#..#...#.#..#.....#.....###.........#...........#.#............#........#.....###.......##.....#.#.#...........#........
                .#.....#....##..##..#...........#.....#.......#.........#...#..............##..........#...#..#..#...#............#.#.#.......#....
                .#..#.#.#.......#....................#................#.#................#..............#..#..##..#.#..#..###....#.....#..#........
                ...#.....#.......##..#............##.....#..#..........#......##.......#..............#.#..#.......#.........#.....................
                ..#.#.....#.......#....#.........##................##....#...#.......................................#.......#.#..##......#...#....
                ...........#.#.#.....#...#.#..#....#..#..............#.#.#....#....##...................#....#......#........#....#..##...#...#....
                ....#........#....#.#..##...##...................#.....#........#....#...#.#.#.#.............#.....#.#.......##..#.#.......#....#..
                .##.#....#.......#.#......##.....#.#.#............#.......#........#...........................#.......##...#...##....#.........#..
                .......#....#................#..##.............###.....#.............#....#......##........#.##...................#................
                ....#.......##.................#...................##..#..............#.......##..##...........#..##...#.#.....#...###.....#.......
                .#.............................##................#......#...#...........#.#.#......#...........##.....##................#.#........
                .#.##.#........##.........#.....##.#...........#...........#.#....##.....##.......#...........#..#.......#.##......#.....#...#...#.
                ...#...##.......#.#...#.......#...#.................#......#..#...............#.#.#........................#...........#.....#.....
                .......#.#...#..##.........#.....#........#..##.#.#....#........#..##..........#...#..#..............#......##..#....#.......#.....
                ...##.......#..#......#...........................#..#.........#.............##........#.........#...#................#..###.......
                .........................##................#.#...##....#......#.#..#....#....#....#..#..........................#.#..#.......#.....
                ....#.....#...#.........#..#............##...#..#........#........##.#..#...........#..........................#...#.....#......#..
                .......................#..............#..#...#...............#..#.#..#..#...#...#.#..........................#.......#..#..........
                ....##.#.............#...#.................##....#......#....#.##........#...............##............##.#.................#...#..
                ...#...#..#...........#........................#....#.#.......#..........#.......##.......................##..#.#....#...........#.
                ..............#......##............#...##.#..........#....#....#.......#...................##..............#...#........#..#..#....
                .......#............##..#.#........#....#.##....#.....#.#.#.....#......#....#..........#...#...#..................#....##..........
                .............#....#...#..#..............#.......#........##...#...#..#....#...........##....#............#....#...#.#.#........#...
                .#.....###.#.....................#..........#.#.....#..#...#.#.#.....................#.............................................
                .#...#...........#.....#...........#....#....##.........#..#......#..#....#.....#....#.#...#..................##.........#..#....#.
                .#.......#......................##.........................#....#...#......##......#........#......#.........#.......##.#...#......
                ....##...........#...#.......#.......##........#................#.......#.#.##.............#..#.#................##.....#..#...##..
                ..........#.#.................#..#..#...##.###.......##.#..#........##......##..##...#...#..#..#####.#.........#..#...#.#..........
                ..#....#..#.#...............#...............#.#..####......#..........##.#...##...#.#................#................#.##..##..#..
                ..........#....##..........#..............#.......#.......#.#...#..##.....................#.#.#....#...#...........#...............
                ...#.......#.................#...........#..#........#...#..............#..............#....#...##....................#...#........
                ...####...#.............##.....#............#.##.....#...#..#.#......#.............#.........##....##...................#.#...#....
                ....#.....#.............#.....##...#..#...........#..#.....#......#.#.....#......#.....#....#......#...............................
                .....#...#..##.............#....##...#.......#...##......##.....#.......#...#........................#.#.......................#.#.
                .###.....#...#................#....#.....................###.#....#..#.#....................#....................................#.
                ...#..................#..#..#........##....#..#.#.##..#.#...#.........#..#.#...#...............#...........##..........##.#........
                ...........#..................#.............#...#.#.#......###..........#...#.......#.......#....#........#.#...........##.........
                .......#..#.......##..#............................##.....#.#..#.......##.....#...#.......#...........#....#...#...................
                ...#.............#.................#.#.###......##.........####.....#..##.............#.......##.....#....................#........
                .#................#.#..#..#..#..##.....#.......#..#.....#.......#....#.......#.............#.##......#.#.....#..............#..#...
                .....#.................#...#....#.#...#.#......#.#...........#............#...#..........................###...#.................#.
                ...........................#..#.#..#...#...............#...#...#....#...........##...........#...#..#.#........#..###........#.....
                ..................##....##......##.#........#..#...........#......#..............#........#...#..............#...#.#..........##...
                ...#...............#...###..#...........#.....#.......##.#...#..........##.....#........#.#.#..................##..#............#..
                ..#........#......#.....#.........#.......##......#..........#...........#..#.##....#...................#.##.......##..........##..
                ...............#...##....###.........#...#..............#.#.......#...#.....#.........##..#.......##..............#................
                ............#........#......##.#................##...#.....##...#.....##.......#..................#........#.##.#.....#.##.........
                ..........#....#....#...##..#.#..........#.............##..#......#.#......#.#..............#........#...#..#............##........
                ...........#.......##...#......#..#......#.#.......#.........#...........#.....#..##...#...##..............##........#.#..#........
                ............#....#.......#..........#..##..#...##...#.#.#.....#............#.#.......#.#..#........##......#....#.#.....#..........
                .......................#...........##.#..........#.....#.#.#..........#.#.............................#....##.....##......#..#.....
                .................................................................S.................................................................
                .....#.##.#..........#..#..#........#.#...#......#......#....#.#.....#.#..............................#.............#.....#........
                ......#.....#....#..#........#.....#.........#........#..#...#.......#.#.....##.....##....#..#.#..#.#..........#....#...#..........
                ...................##....#........#.#.........#.......#........................#.....#.#...#..###.......###..#...#.....##..........
                .........#.#...#.#.#.#......#............#....#.#........................#.......#.#.#........#..............#..#.#...#............
                ...............#..#.#...#..#......#....#....#.......##...............#.#.#..#......#...##.........................#................
                .#.....................#..#..#..............#....#...#...#....##....#.#...#.......##.#...........###...#.......#####...............
                ..#........#............#.#...#.......#...#...........#......#....#...........#..#..............#....#..#...##.......#..........##.
                .#.#.....................#..............#.#.........#.#...............#......#......#.#..##...#......#......#........##............
                ..............#....#.#....##.##.....#........#...............#..........................#...#....#.##.........#....................
                ..................##...............##..#....##..............#.....#...#........#.#...#...............###....#................#.###.
                .#...#............#.#.#..##....#......#........#.#........#.....#......#.......##.....#.#.#.....................#..................
                ...#.#.............#.............#.#.##...#.#.............................................#....##..#.#.....#..................#....
                ......#............#...#.......#.#..#......#.......#.....#.#.......#...##....##....##.............####...................#..#......
                .........#........#.....#..#...........#.#.......##.#..#....#..#.....#.#..#.#....#......#...................#.............#....#.#.
                ......#................#..................#............#.............#.....#.........#...##.....#.#.##..#..###.........##.......#..
                .............................#....#.....#.#............##....#..#......#..#.#....#.................#....#...#.........#............
                ....#.#.....................#........#.........##..............#...#..............................#....#.................#.......#.
                .#..#.................#..........#..#....#........##..#...............#......####.....#....#.....#..#....###........#.#.........#..
                ....##........#.........#...#..##.#.##....#......##........#......###..........#.#...#....#..#......................#........##....
                ........#.....#.#.........#......#.#........#....#..##....##................##.......#...#........#...........................#....
                .#...........#............#..........#.......#.##.......#.#........#...#..###...#..#......#.............#................##....##..
                ..................#..........##...##....##.#.....#.....####........##........#...#.........#...#.....#..#...........##......#..#.#.
                ...............#.....................#................#...#....#......................#.#.......#...............#.....#......#...#.
                ...#............#.............#.##...................#....#...#.....#...#...........#.#...#........#................##.....#.......
                ...........#........#..................#.#..#.#.....#...............#.....#.#........##.......#..#.#..........#.............#......
                ..#.....#....#.#.................#.#.........#.......##.....#.........#.....#...............#.#...##.......................#....#..
                ......###....#....#.#..#....................#....#....#..#........#...#.#...##........#..##........#............#.........#....#.#.
                ...#.#.....#....#......#.........#..##...#.##...#....#..##..#.#........#..##.#.................#...................................
                .........###.#...#...#...........................#.........#.#.##....#.#...#..........#..#.......#.........##.....#......#...#.#...
                .................#.....#..........#.#..#..###..................#........##....#.........#...................#....#.........#.....#.
                .#..#....#..#...#.....#............#.#..........#....#.#..#..##......................#..#..#......................#.............#..
                ..#..#.#...#..#.....#...............................#.........##......#.............#.##...............#..#.##.......##..#.......#.
                .....#...#.#....#...#..#..............#......#.#................#....#..#...........#.....#.#................#.##.........##.......
                ....#......##.........#.#...#.........#......#.##...##........#....#.................#......................###......#.....##......
                ...#.#.....#.....#.#.#.#...............#..#.....#.#...............#.#.........##.....##..#...................#.......#.#...........
                ..#.....#..#.....#...##....##..##.........#...#....#....#...#......##.##..#..#.........#............#..#.##...................#....
                ...#....###...#..........##......#........#..........#.............###.....#.....#..#.#...............#...##....#...##..#..#...#.#.
                ...#................#.........#................#..#..#..#.#...............#.....#...................#.................#...#........
                .#.......#.#.#.#.......#...................#...#......##.....#........##.....#...#........................#..#..#....#......#..#...
                ..##..#....#...#.......#........#...#....................###........##............#...............#....#.......#............#......
                .#............#.....#...##....#.......................#..#....#........#..........#..#...........#..#........................#.....
                ..........###....#..#.#..#..#.........#.......#...#......#....#...#.............#............#.....................#.#...#.......#.
                ...#..#..............................#.........#........##....##....##..##.....##......................#........#.....#...#...#.#..
                .#.#.................##.......#.#.#.....................#.....#........#......##.............#.......#..##....##........#.#.#......
                ...##.#.#..#...#........#......#.....#....................#........#.#.....#...#................#........#...#.##.....#..#.......#.
                .##.#.......#..#....#..#....#......#.....................#...........#......#.#..............#...#......#.#.......#......#.#.......
                ....#................###...#.......#...#..##........#...................#.......................#..##.......#................###...
                .........##.....#.....##..........#....#..##.............#.....##......##....#..................#..##.................#...#........
                .#..#....#....#.#........#..#................#............#.......#........#...................................##........#.......#.
                .........##...#........#.#............#.......#..........#.................#..........................#......##.....#....#.#....##.
                ...##......................#.....#....#.##...................#.............#..............#....#......#.............#........#.....
                ....#...........##.......#...#.....#.......#..#................#........##......................#..#....#..##.....#.#..............
                ......#..#...#......#.......#.....#.#..........#................#................#.....#.#.#....#...#..............................
                ....#....#..#...##..##.......#...................##..............................#........#................#....#..........#..#.#..
                ....#...##.....##...#......#.............#.......#..............................#..........#...............................#.#.....
                .##.#.....#..#.......#..##................#..#..##..#..........#..............#..#.#....#.#..#..##.#....#.##..#............#.....#.
                ....#..#.#............##.....##.............###.#............#.#.....#....................#.#........#....#.#..#..#...........#.#..
                .#.......#..................#...................#....#..........#...........#....#......#.........#.............##...............#.
                ..#...............##..#.#...###.....#...#....#....#...#........#..#....................##.#.......#...#.......#................#...
                ..#.##..........##......#...#.#.#.#.....##.....#.##..#..#.........#........#....................#.................#............##..
                ....#...##.......##....##...#.#..............#.....#......................#.#......#...................#..#.#...##.#..........#..#.
                .#.#....#..##..#..............###.......................###................#..#..#..##....#....#............##..#..................
                ......#..#......#.........#.#.#...#.......................##..............##...#.....##.#....#......#....#.........#.......#.....#.
                ....#.........#...............#...#............#.........#................##.#..........#.............#.......................#.##.
                ...................................................................................................................................""";

        var steps = 64;

        var map = input.lines().map(String::toCharArray).toArray(char[][]::new);
        var visited = new boolean[map.length][map[0].length][4];
        var visitedResult = new boolean[map.length][map[0].length];

        for(int i = 0; i < map.length; i++) {
            visited[i] = new boolean[map[0].length][4];
            visitedResult[i] = new boolean[map[0].length];

            for(int j = 0; j < map[0].length; j++) {
                visited[i][j] = new boolean[4];
            }
        }

        var start = findStart(map);

        travel(start, map, visited,visitedResult, steps, 0);

        int result = 0;

        for(int i = 0; i < map.length; i++) {
            for(int j = 0; j < map[0].length; j++) {
                if(visitedResult[i][j]) {
                    result++;
                    System.out.print("O");
                }
                else {
                    System.out.print(map[i][j]);
                }
            }
            System.out.println();
        }

        System.out.println(result);
    }

    private static void travel(Point point, char[][] map,
                               boolean[][][] visited,
                               boolean[][] visitedResult,
                               int steps,
                               int dir) {
        if(point.row < 0 || point.row >= map.length || point.col < 0 || point.col >= map[0].length) {
            return;
        }

        if(map[point.row][point.col] == '#') {
            return;
        }

        if(steps % 2 == 0) {
            visitedResult[point.row][point.col] = true;
        }

        var allVisited = true;
        for (int i = 0; i < 4; i++) {
            if(!visited[point.row][point.col][i]) {
                allVisited = false;
                break;
            }
        }

        if(allVisited) {
            return;
        }

        visited[point.row][point.col][dir] = true;

        if(steps == 0) {
            return;
        }

        travel(new Point(point.row + 1, point.col), map, visited, visitedResult, steps - 1, 0);
        travel(new Point(point.row - 1, point.col), map, visited, visitedResult, steps - 1, 1);
        travel(new Point(point.row, point.col + 1), map, visited, visitedResult, steps - 1, 2);
        travel(new Point(point.row, point.col - 1), map, visited, visitedResult, steps - 1, 3);
    }

    private static Point findStart(char[][] map) {
        for (int i = 0; i < map.length; i++) {
            var row = map[i];

            for (int j = 0; j < row.length; j++) {
                if (row[j] == 'S') {
                    return new Point(i, j);
                }
            }
        }
        throw new RuntimeException("Start not found");
    }
}
